{
    "contents" : "#setwd(\"C:/Users/mcdaniel/Documents/SPORTIF/AnalChap\")\n#load(\"../sportif.RData\")\nload(\"sportif.RData\")\ndat <- subset(sportif, study==\"SH-TPA-0003\")\n#attach(dat)\n\nendtime <- 900/365\n\ncentime <- endtime + 0.000001\n\n\n\ntime <- pmin(dat$primaryd/365, dat$sensit2d/365, dat$evmbleed/365, dat$evminor/365)\n\n\n\ntreat <- factor(dat$RANDCODE)\n\ntr <- rep(0, length(treat))\ntr[treat==levels(treat)[1]] <- 1\n\nevent <- pmax(dat$PRIMARY, dat$SENSIT2, dat$major, dat$minor)\n\nlibrary(survival)\n\n\nsumX0 <- sum(time[tr==0])\nsumX1 <- sum(time[tr==1])\nsumevent0 <- sum(event[tr==0])\nsumevent1 <- sum(event[tr==1])\n\nlamhat1 <- sumevent1/sumX1\nlamhat0 <- sumevent0/sumX0\nev0 <- sumevent0\nev1 <- sumevent1\n\ndelta <- 0.02\n\nexpstat <- (lamhat1 - lamhat0 -delta)/sqrt((lamhat1^2)/ev1 + (lamhat0^2)/ev0)\n\nlamhat1-lamhat0 + qnorm(0.975)*sqrt((lamhat1^2)/ev1 + (lamhat0^2)/ev0)\n# -0.00905\n\ndeltavec[which.max(scorestat < -qnorm(0.975))]\n# -0.00585\nsqrt(lam^2/(ev0+ev1))\n\nlam <- (sumevent0+sumevent1)/(sumX0 + sumX1)\nlam\n# 0.3315381\n\nsqrt(lam^2/(ev0+ev1))\n# 0.0096108\n\nmean(event)\n# 0.34928\n\n\n\nlam <- (sumevent0+sumevent1)/(sumX0 + sumX1)\nlam\n\nucl <- lam + 1.96*sqrt(lam^2/(ev0+ev1))\nlcl <- lam - 1.96*sqrt(lam^2/(ev0+ev1))\nlibrary(muhaz)\nlibrary(ggplot2)\nmh <- muhaz(time, event, max.time=max(time))\n\npldf <- data.frame(haz = mh$haz.est, grid = mh$est.grid)\n\n\npl <- ggplot(data=pldf) + geom_line(aes(x=grid, y=haz))  + geom_line(aes(x=pldf$grid, y=rep(lam, length(pldf$grid))), color=\"red\")\npl <- pl + geom_line(aes(x=pldf$grid, y=rep(ucl, length(pldf$grid))), linetype=2, color=\"red\") + geom_line(aes(x=pldf$grid, y=rep(lcl, length(pldf$grid))), linetype=2, color=\"red\")\npl <- pl + theme_bw() + ylab(\"Hazard Estimate (events/year)\") + xlab(\"Time (years)\")\npl\npdf(\"anybadhaz.pdf\")\npl\ndev.off()\n\nmhE <- muhaz(time[tr==1], event[tr==1], max.time=2)\nmhC <- muhaz(time[tr==0], event[tr==0], max.time=2)\nplot(mhC)\nplot(mhE)\n\nucl0 <- lamhat0 + 1.96*sqrt(lamhat0^2/(ev0))\nlcl0 <- lamhat0 - 1.96*sqrt(lamhat0^2/(ev0))\n\nucl1 <- lamhat1 + 1.96*sqrt(lamhat1^2/(ev1))\nlcl1 <- lamhat1 - 1.96*sqrt(lamhat1^2/(ev1))\nshift <- 0\n\n#mhC <- controlhaz\n#mhE <- treathaz\n\ncanno <- c(1703, 1472, 1383, 1090, 838)\neanno <- c(1704, 1468, 1373, 1109, 860)\ncev <- c(0, 399, 148, 71, 13)\neev <- c(0, 353, 125, 63, 14)\n\npldf2 <- data.frame(haz = c(mhC$haz.est, mhE$haz.est)*365, grid = c(mhC$est.grid, mhE$est.grid)/365, Group=c(rep(\"Control\", 101), rep(\"Experimental\", 101)))\npl <- ggplot(data=pldf2) + stat_smooth(aes(x=grid, y=haz, color=Group), se=FALSE)  #+ geom_line(aes(x=pldf2$grid, y=rep(lamhat0, length(pldf2$grid))), color=\"red\")\n#pl <- pl + geom_line(aes(x=pldf2$grid, y=rep(ucl0, length(pldf2$grid))), linetype=2, color=\"red\") + geom_line(aes(x=pldf2$grid, y=rep(lcl0, length(pldf2$grid))), linetype=2, color=\"red\")\n#pl <- pl + geom_line(aes(x=pldf2$grid, y=rep(ucl1, length(pldf2$grid))), linetype=2, color=\"blue\") + geom_line(aes(x=pldf2$grid, y=rep(lcl1, length(pldf2$grid))), linetype=2, color=\"blue\")\n#pl <- pl + geom_line(aes(x=pldf2$grid, y=rep(lamhat1, length(pldf2$grid))), linetype=1, color=\"blue\")\npl <- pl + theme_bw() + ylab(\"Hazard Estimate (events/year)\") + xlab(\"Time (years)\")+scale_color_manual(values=c(\"red\", \"blue\"))\npl <- pl + annotate(\"text\", x=-0.09, y=1.01+shift, label=\"Number At Risk\", hjust=0, vjust=0.5)\npl <- pl + annotate(\"text\", x=c(0, 0.5, 1, 1.5, 2), y=0.98+shift, label=canno, hjust=0.5, vjust=0.5, color=\"red\")\npl <- pl + annotate(\"text\", x=c(0, 0.5, 1, 1.5, 2), y=0.95+shift, label=eanno, hjust=0.5, vjust=0.5, color=\"blue\")\npl <- pl + annotate(\"text\", x=-0.09, y=0.90+shift, label=\"Events in Past 0.5 Years\", hjust=0, vjust=0.5)\npl <- pl + annotate(\"text\", x=c(0, 0.5, 1, 1.5, 2), y=0.87+shift, label=cev, hjust=0.5, vjust=0.5, color=\"red\")\npl <- pl + annotate(\"text\", x=c(0, 0.5, 1, 1.5, 2), y=0.84+shift, label=eev, hjust=0.5, vjust=0.5, color=\"blue\")\npl <- pl + scale_color_manual(values=c(\"red\", \"blue\")) + opts(legend.position=\"bottom\")\npl\n\n\n\npdf(\"anybadsplit.pdf\")\npl\ndev.off()\n#save(file=\"allhaz.RData\", list=c(\"mh\"))",
    "created" : 1443467291960.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "1634415377",
    "id" : "63F31C4C",
    "lastKnownWriteTime" : 1443041585,
    "path" : "C:/Users/lmcda4/Dropbox/Thesis/AnalChap/SPORTIF/RCodeJuly23/anybadhaz.R",
    "project_path" : null,
    "properties" : {
    },
    "source_on_save" : false,
    "type" : "r_source"
}