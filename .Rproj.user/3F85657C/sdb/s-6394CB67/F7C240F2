{
    "contents" : "setwd(\"C:/Users/mcdaniel/Documents/SPORTIF/AnalChap\")\ndat <- subset(sportif, study==\"SH-TPA-0003\")\n#attach(dat)\n\nendtime <- 900/365\n\ncentime <- endtime + 0.000001\n\n\n\ndead <- dat$primaryd/365\n\n\n\ntreat <- factor(dat$RANDCODE)\n\ntr <- rep(0, length(treat))\ntr[treat==levels(treat)[1]] <- 1\n\neventdead <- dat$PRIMARY\n\nlibrary(survival)\n\ndeltavec <- seq(from=-0.007, to=-0.005, length.out=1001)\nscorestat <- rep(0, length(deltavec))\nfor(i in 1:length(deltavec)){\n  \n  delta <- deltavec[i]\n  events <- dead < centime\n  \n  \n  \n  \n  \n  \n  \n  \n  n1 <- sum(tr)\n  n0 <- length(tr)-n1\n  n <- n1+n0\n  \n  biglist <- data.frame(obs = dead + runif(n, 0, 0.001), event = eventdead, treat = tr)\n  sortlist <- biglist[order(biglist$obs),]\n  Zbar <- (n1 - cumsum(sortlist$treat))/((n0+n1)-(0:(n0+n1-1)))\n  \n  Y <- (n0+n1):1\n  Y1 <- n1 - cumsum(sortlist$treat)\n  Y0 <- n0- cumsum(1-sortlist$treat)\n  Yfunc <- Y1*Y0/Y\n  score <- crossprod(sortlist$treat-Zbar, sortlist$event)\n  \n  offset.function <- (1-Zbar)*Y1\n  \n  \n  deloffset<- delta*sum((sortlist$obs[1:n] - c(0,sortlist$obs[1:(n-1)]))*(offset.function[1:n]))\n  \n  score <- score - deloffset\n  \n  Ydiff <- Y0 - Y1\n  \n  lY0 <- c(n0, Y0)\n  lY1 <- c(n1, Y1)\n  lY <- c(n, Y)\n  \n  vhat <- crossprod((Y0*Y1)/(Y^2) , sortlist$event) + crossprod((lY0[1:n]*lY1[1:n]/lY[1:n]^2), delta*(sortlist$obs[1:n] - c(0,sortlist$obs[1:(n-1)]))*(Ydiff[1:n]))\n  \n  scorestat[i] <- score/sqrt(vhat)\n}\n\nsoldel <- (crossprod(Y1/Y, (1-sortlist$treat)*sortlist$event)+ crossprod(Y0/Y, (sortlist$treat)*sortlist$event) - 1.96*crossprod(Y1*Y0/(Y^2), sortlist$event))/((-1+1.96)*crossprod((lY0[1:n]*lY1[1:n]/lY[1:n]^2), (sortlist$obs[1:n] - c(0,sortlist$obs[1:(n-1)]))*(Y+Ydiff[1:n])))\nsoldel\n# Limit for score test is 0.000181\n\ndelta <- soldel\nscore <- crossprod(sortlist$treat-Zbar, sortlist$event)\noffset.function <- (1-Zbar)*Y1\ndeloffset<- delta*sum((sortlist$obs[1:n] - c(0,sortlist$obs[1:(n-1)]))*(offset.function[1:n]))\nscore <- score - deloffset\nvhat <- crossprod((Y0*Y1)/(Y^2) , sortlist$event) + crossprod((lY0[1:n]*lY1[1:n]/lY[1:n]^2), delta*(sortlist$obs[1:n] - c(0,sortlist$obs[1:(n-1)]))*(Ydiff[1:n]))\n\n\nscore/sqrt(vhat)\n\n\nsumX0 <- sum(dead[tr==0])\nsumX1 <- sum(dead[tr==1])\nsumevent0 <- sum(eventdead[tr==0])\nsumevent1 <- sum(eventdead[tr==1])\n\nlamhat1 <- sumevent1/sumX1\nlamhat0 <- sumevent0/sumX0\nev0 <- sumevent0\nev1 <- sumevent1\n\nexpstat <- (lamhat1 - lamhat0 -delta)/sqrt((lamhat1^2)/ev1 + (lamhat0^2)/ev0)\n\nlamhat1-lamhat0 + qnorm(0.975)*sqrt((lamhat1^2)/ev1 + (lamhat0^2)/ev0)\n# EXPO upper bound: 0.001266\n\ndeltavec[which.max(scorestat < -qnorm(0.975))]\n# LY Upper bound: 0.001323\n\n\ndeltavec[which.max(scorestat < 0)]\n# LY Point estimate: -0.00653\n\nsqrt(lam^2/(ev0+ev1))\n\nlam <- (sumevent0+sumevent1)/(sumX0 + sumX1)\nlam\n# 0.01964488\n\nlamhat1-lamhat0\n# Exponential difference is: -0.0066\n\nsqrt(lam^2/(ev0+ev1))\n# 0.002005\n\nmean(eventdead)\n# 0.028177",
    "created" : 1443467124659.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "4079168653",
    "id" : "F7C240F2",
    "lastKnownWriteTime" : 1406145940,
    "path" : "C:/Users/lmcda4/Dropbox/Thesis/AnalChap/SPORTIF/RCodeJuly23/primary.R",
    "project_path" : null,
    "properties" : {
    },
    "source_on_save" : false,
    "type" : "r_source"
}