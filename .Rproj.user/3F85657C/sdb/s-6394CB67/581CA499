{
    "contents" : "setwd(\"C:/Users/mcdaniel/Documents/SPORTIF/AnalChap\")\nload(\"../sportif.RData\")\n\ndat <- subset(sportif, study==\"SH-TPA-0003\")\n#attach(dat)\n\nendtime <- 900/365\n\ncentime <- endtime + 0.000001\n\n\n\ntime <- dat$primaryd/365\n\n\n\ntreat <- factor(dat$RANDCODE)\n\ntr <- rep(0, length(treat))\ntr[treat==levels(treat)[1]] <- 1\n\nevent <- dat$PRIMARY\n\nlibrary(survival)\n\n\n\nsumX0 <- sum(time[tr==0])\nsumX1 <- sum(time[tr==1])\nsumevent0 <- sum(event[tr==0])\nsumevent1 <- sum(event[tr==1])\n\nlamhat1 <- sumevent1/sumX1\nlamhat0 <- sumevent0/sumX0\nev0 <- sumevent0\nev1 <- sumevent1\n\nexpstat <- (lamhat1 - lamhat0 -delta)/sqrt((lamhat1^2)/ev1 + (lamhat0^2)/ev0)\n\nlamhat1-lamhat0 + qnorm(0.975)*sqrt((lamhat1^2)/ev1 + (lamhat0^2)/ev0)\n# -0.00905\n\ndeltavec[which.max(scorestat < -qnorm(0.975))]\n# -0.00585\nsqrt(lam^2/(ev0+ev1))\n\nlam <- (sumevent0+sumevent1)/(sumX0 + sumX1)\nlam\n# 0.3315381\n\nsqrt(lam^2/(ev0+ev1))\n# 0.0096108\n\nmean(event)\n# 0.34928\n\n\n\nlam <- (sumevent0+sumevent1)/(sumX0 + sumX1)\nlam\n\nucl <- lam + 1.96*sqrt(lam^2/(ev0+ev1))\nlcl <- lam - 1.96*sqrt(lam^2/(ev0+ev1))\nlibrary(muhaz)\nlibrary(ggplot2)\nmh <- muhaz(time, event)\n\npldf <- data.frame(haz = mh$haz.est, grid = mh$est.grid)\n\npl <- ggplot(data=pldf) + geom_line(aes(x=grid, y=haz))  + geom_line(aes(x=pldf$grid, y=rep(lam, length(pldf$grid))), color=\"red\")\npl <- pl + geom_line(aes(x=pldf$grid, y=rep(ucl, length(pldf$grid))), linetype=2, color=\"red\") + geom_line(aes(x=pldf$grid, y=rep(lcl, length(pldf$grid))), linetype=2, color=\"red\")\npl <- pl + theme_bw() + ylab(\"Hazard Estimate (events/year)\") + xlab(\"Time (years)\")\npl\npdf(\"primaryhaz.pdf\")\npl\ndev.off()\n\n\nmhE <- muhaz(time[tr==1], event[tr==1], max.time=2)\nmhC <- muhaz(time[tr==0], event[tr==0], max.time=2)\nplot(mhC)\nplot(mhE)\n\nucl0 <- lamhat0 + 1.96*sqrt(lamhat0^2/(ev0))\nlcl0 <- lamhat0 - 1.96*sqrt(lamhat0^2/(ev0))\n\nucl1 <- lamhat1 + 1.96*sqrt(lamhat1^2/(ev1))\nlcl1 <- lamhat1 - 1.96*sqrt(lamhat1^2/(ev1))\nshift <- 0.0012\n\npldf2 <- data.frame(haz = c(mhC$haz.est, mhE$haz.est), grid = c(mhC$est.grid, mhE$est.grid), Group=c(rep(\"Control\", 101), rep(\"Experimental\", 101)))\npl <- ggplot(data=pldf2) + stat_smooth(aes(x=grid, y=haz, color=Group), se=FALSE)  + geom_line(aes(x=pldf$grid, y=rep(lamhat0, length(pldf$grid))), color=\"red\")\npl <- pl + geom_line(aes(x=pldf$grid, y=rep(ucl0, length(pldf$grid))), linetype=2, color=\"red\") + geom_line(aes(x=pldf$grid, y=rep(lcl0, length(pldf$grid))), linetype=2, color=\"red\")\npl <- pl + geom_line(aes(x=pldf$grid, y=rep(ucl1, length(pldf$grid))), linetype=2, color=\"blue\") + geom_line(aes(x=pldf$grid, y=rep(lcl1, length(pldf$grid))), linetype=2, color=\"blue\")\npl <- pl + geom_line(aes(x=pldf$grid, y=rep(lamhat1, length(pldf$grid))), linetype=1, color=\"blue\")\npl <- pl + theme_bw() + ylab(\"Hazard Estimate (events/year)\") + xlab(\"Time (years)\")+scale_color_manual(values=c(\"red\", \"blue\"))\npl <- pl + annotate(\"text\", x=-0.09, y=0.031+5*shift+0.0005, label=\"Number At Risk\", hjust=0, vjust=0.5)\npl <- pl + annotate(\"text\", x=c(0, 0.5, 1, 1.5, 2), y=0.031+4*shift+0.0005, label=canno, hjust=0.5, vjust=0.5, color=\"red\")\npl <- pl + annotate(\"text\", x=c(0, 0.5, 1, 1.5, 2), y=0.031+3*shift+0.0005, label=eanno, hjust=0.5, vjust=0.5, color=\"blue\")\npl <- pl + annotate(\"text\", x=-0.09, y=0.031+2*shift, label=\"Events in Past 0.5 Years\", hjust=0, vjust=0.5)\npl <- pl + annotate(\"text\", x=c(0, 0.5, 1, 1.5, 2), y=0.031+shift, label=cev, hjust=0.5, vjust=0.5, color=\"red\")\npl <- pl + annotate(\"text\", x=c(0, 0.5, 1, 1.5, 2), y=0.031, label=eev, hjust=0.5, vjust=0.5, color=\"blue\")\npl <- pl + scale_color_manual(values=c(\"red\", \"blue\")) + opts(legend.position=\"bottom\") +ylim(c(0, 0.031+5*shift+0.0005))\npl\n\npdf(\"primaryhazsplit.pdf\")\npl\ndev.off()\n\nT0 <- subset(time, tr==0)\nT1 <- subset(time, tr==1)\n\n\ncanno <- c(Y0[1])\ncanno <- c(canno, Y0[which.min(sort(T0) < 0.5)])\ncanno <- c(canno, Y0[which.min(sort(T0) < 1)])\ncanno <- c(canno, Y0[which.min(sort(T0) < 1.5)])\ncanno <- c(canno, Y0[which.min(sort(T0) < 2)])\n\n\neanno <- c(Y1[1])\neanno <- c(eanno, Y1[which.min(sort(T1) < 0.5)])\neanno <- c(eanno, Y1[which.min(sort(T1) < 1)])\neanno <- c(eanno, Y1[which.min(sort(T1) < 1.5)])\neanno <- c(eanno, Y1[which.min(sort(T1) < 2)])\n\nev1 <- subset(event, tr==1)\nev0 <- subset(event, tr==0)\n\ncev <- c(0)\ncev <- c(cev, sum(ev0[T0 < 0.5 & T0 > 0]))\ncev <- c(cev, sum(ev0[T0 < 1 & T0 > 0.5]))\ncev <- c(cev, sum(ev0[T0 < 1.5 & T0 > 1]))\ncev <- c(cev, sum(ev0[T0 < 2 & T0 > 1.5]))\n\n\neev <- c(0)\neev <- c(eev, sum(ev1[T1 < 0.5 & T1 > 0]))\neev <- c(eev, sum(ev1[T1 < 1 & T1 > 0.5]))\neev <- c(eev, sum(ev1[T1 < 1.5 & T1 > 1]))\neev <- c(eev, sum(ev1[T1 < 2 & T1 > 1.5]))\n\n\nsave(file=\"primaryhaz.RData\", list=c(\"mh\", \"lam\", \"ucl\", \"lcl\"))\n",
    "created" : 1443467088583.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "153878893",
    "id" : "581CA499",
    "lastKnownWriteTime" : 1406152477,
    "path" : "C:/Users/lmcda4/Dropbox/Thesis/AnalChap/SPORTIF/RCodeJuly23/primaryhaz.R",
    "project_path" : null,
    "properties" : {
    },
    "source_on_save" : false,
    "type" : "r_source"
}